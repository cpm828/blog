---
title:        执行命令自动复制粘贴文件 # 标题
description:  执行命令自动复制粘贴文件  # 副标题
date:         2017-04-03 # 建立日期
comments:     true  # 开启评论功能
tags: # 标签分类
    - Node
---


## 拷贝脚本，修改后面的复制粘贴目录即可：
```
var fs = require('fs')
var path = require("path")
var process = require('process')

// 文件遍历，为一切操作的基础方法
function traversal (dir, cb_isDir, cb_isFile) {
  var absDir = path.resolve(dir)
  fs.readdirSync(absDir).forEach(file => {
    var pathname = path.join(absDir, file)
    if (fs.statSync(pathname).isDirectory()) {
      // 文件夹操作
      // stop： 是否停止在该文件夹遍历
      // 回调函数中不返回或返回false，继续遍历该文件夹。
      // 回调函数中返回true, 停止遍历该文件夹。例如回调函数要删除文件夹时。
      // 回调函数中返回字符串，会按返回值进行遍历。例如回调函数更改了文件夹名称时。
      var stop = false
      if (cb_isDir) stop = cb_isDir(pathname)
      if(!stop) {
        // 如果停止标志返回false，则继续遍历
        traversal(pathname, cb_isDir, cb_isFile)
      } else if (typeof stop === 'string') {
        // 如果停止标志返回了新的路径，则遍历新的路径
        traversal(path.resolve(stop), cb_isDir, cb_isFile)
      }
    } else {
      // 文件操作
      if(cb_isFile) cb_isFile(pathname)
    }
  })
}

// 复制文件
function copy (src, dest) {
  // 内部函数，对指定路径的复制操作
  function _copy(pathname) {
    var destPath = path.resolve(pathname)
        .replace(path.resolve(src), path.resolve(dest))
    if (fs.statSync(pathname).isFile()) {
      // 如果原路径是文件，直接复制
      console.log(`正在复制文件${destPath} ...`)
      if (src === pathname) {
        fs.writeFileSync(path.join(destPath, path.basename(src)), fs.readFileSync(path.resolve(pathname)))
      } else {
        fs.writeFileSync(path.join(destPath), fs.readFileSync(path.resolve(pathname)))
      }
    } else {
      // 如果原路径是文件夹，检测是否在目标路径存在
      // 若不存在则新建文件夹，否则不做任何事情
      try {
        fs.statSync(destPath)
      } catch (err) {
        if (err.code === 'ENOENT') {
          console.log(`正在创建文件夹${destPath} ...`)
          fs.mkdirSync(destPath)
        } else console.error(err)
      }
    }
  }
  // copy函数主体
  if (fs.statSync(src).isDirectory()) traversal(src, _copy, _copy)
  else _copy(src)
}

// 清除指定目录下的所有文件（不删除目录）
function clear(src) {
  traversal(src, null, pathname => {
    console.log(`正在删除文件${pathname} ...`)
    fs.unlinkSync(pathname)
  })
  traversal(src, pathname => {
    console.log(`正在删除文件夹${pathname} ...`)
    fs.rmdirSync(pathname)
    return true
  }, null)
}


// 执行本项目复制命令命令
!function(){
  // 复制前的目录
  var former_template = './dist'
  var former_static = './dist/static'

  // 复制后的目录
  var dist_template = '../kuaihongbao/guessgame/templates'
  var dist_static = '../kuaihongbao/guessgame/static'

  // 清除目录
  clear(dist_template)
  clear(dist_static)

  // 复制目录
  copy(former_template + '/guess-index.html', dist_template)
  copy(former_static, dist_static)
}()
```

## 使用方法
* 手动执行复制命令
```bash
run build完之后执行命令：node build/**.js
```

* 自动复制命令
对于vue-cli来说，将脚本添加到build目录下
```
在 packet.json中的script dev build 中添加 "&& node build/**.js"
编译：cnpm run build 时会自动执行复制脚本
```

## 注意
```
后端需要的index文件的名称可能不一定，在vue/config/index.js中的编译配置里面修改编译后的名称即可
```
